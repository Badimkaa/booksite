# Инструкция по развертыванию на Beget VPS

Эта инструкция поможет вам запустить ваш сайт на виртуальном сервере Beget.

## Шаг 1: Покупка сервера

1.  Зайдите в панель управления Beget -> **Облако (VPS)**.
2.  Нажмите **Создать сервер**.
3.  Выберите:
    *   **ОС:** Ubuntu 22.04 (или 24.04).
    *   **Конфигурация:** 2 vCPU, 2 GB RAM, 15 GB NVMe (этого достаточно).
4.  Создайте сервер. Через пару минут он появится в списке.
5.  Вам на почту (и в панель) придет **IP-адрес** сервера и пароль пользователя `root`.

## Шаг 2: Подключение к серверу

Вам понадобится терминал (консоль).
*   **На Mac/Linux:** Откройте программу "Терминал".
*   **На Windows:** Используйте PowerShell или Putty.

Введите команду (замените `IP_ВАШЕГО_СЕРВЕРА` на цифры, например `1.2.3.4`):
```bash
ssh root@IP_ВАШЕГО_СЕРВЕРА
```
Вас спросят пароль. Введите его (символы не будут отображаться при вводе) и нажмите Enter.

### (Опционально) Настройка входа без пароля (SSH-ключ)

Это очень удобно и безопасно.

1.  **На вашем компьютере** проверьте, есть ли у вас уже ключи:
    ```bash
    ls ~/.ssh/*.pub
    ```
    *   Если вы видите файлы (например, `id_rsa.pub` или `id_ed25519.pub`) — **отлично, используем их!** (Переходите к пункту 3).
    *   Если файлов нет (или ошибка) — создаем новый.

2.  **Создание ключа (только если его нет):**
    ```bash
    ssh-keygen -t ed25519 -C "my-key"
    ```
    (Нажимайте Enter на все вопросы). Это создаст новый файл `id_ed25519` и **не затронет** ваши старые ключи, если они были.

3.  **Отправка ключа на сервер:**
    Введите команду:
    ```bash
        ssh-copy-id root@IP_ВАШЕГО_СЕРВЕРА
    ```
    *(Замените `IP_ВАШЕГО_СЕРВЕРА` на цифры).*
    Вас один раз спросят пароль от сервера. Введите его.

Теперь вы сможете заходить на сервер командой `ssh root@IP_ВАШЕГО_СЕРВЕРА` мгновенно и без пароля.

## Шаг 3: Настройка окружения (Node.js)

Скопируйте и вставьте эти команды по очереди в терминал сервера:

1.  **Обновим списки пакетов:**
    ```bash
    apt update && apt upgrade -y
    ```

2.  **Установим Node.js (версия 20):**
    ```bash
    curl -fsSL https://deb.nodesource.com/setup_20.x | bash -
    apt install -y nodejs
    ```

3.  **Установим PM2 (менеджер процессов) и Nginx (веб-сервер):**
    ```bash
    npm install -g pm2
    apt install -y nginx
    ```

## Шаг 4: Загрузка кода сайта

Выберите **один** из двух способов.

### Способ А: Через Git (Рекомендуемый)
Если вы используете GitHub / GitLab.

1.  **На компьютере:** Загрузите код в свой репозиторий:
    ```bash
    git add .
    git commit -m "Deploy"
    git push
    ```
2.  **На сервере:**
    *   Клонируйте репозиторий (вам понадобится HTTPS ссылка на него):
        ```bash
        git clone https://github.com/ВАШ_ЛОГИН/ВАШ_РЕПО.git /root/app
        ```
        *(Если репозиторий приватный, вас попросят логин и пароль/токен от GitHub).*
    *   **Важно:** Так как мы скрыли папку `data` (чтобы не потерять данные), она будет пустой.
3.  **Загрузка данных:**
    *   Зайдите в **Файловый менеджер Beget**.
    *   Откройте папку `/root/app/data`.
    *   Загрузите туда ваши файлы `chapters.json`, `settings.json` и другие из папки `data` с вашего компьютера.

### Способ Б: Через Файловый менеджер (Простой)
Если не хотите возиться с Git.

1.  В панели Beget перейдите в **Файловый менеджер**.
2.  Найдите ваш сервер и зайдите в папку `/root`.
3.  Создайте папку `app`.
4.  **На вашем компьютере:**
    *   **Не включайте в архив** папки `.next` и `node_modules`.
    *   Заархивируйте все остальные файлы проекта в `site.zip`.
5.  **В браузере (Beget):**
    *   Загрузите `site.zip` в папку `/root/app`.
    *   Распакуйте архив (правой кнопкой -> Распаковать).

## Шаг 5: Запуск сайта

Вернитесь в терминал (где вы подключены по SSH).

1.  Перейдите в папку с сайтом:
    ```bash
    cd /root/app
    ```

2.  Установите зависимости:
    ```bash
    npm install
    ```

3.  Соберите проект (это займет 1-2 минуты):
    ```bash
    npm run build
    ```
    *Если серверу не хватит памяти, он может зависнуть. Если это случилось — напишите мне, добавим Swap.*

4.  Запустите сайт через PM2:
    ```bash
    pm2 start ecosystem.config.js
    pm2 save
    pm2 startup
    ```
    (После команды `pm2 startup` вам могут показать команду, которую нужно скопировать и выполнить. Сделайте это).

Теперь ваш сайт работает на порту 3000! Но он пока недоступен из интернета.

## Шаг 6: Настройка домена и Nginx

1.  **Направьте домен:** В панели управления доменом (где вы его купили) пропишите A-запись с IP-адресом вашего сервера.

2.  **Настройте Nginx:**
    Откройте конфиг:
    ```bash
    nano /etc/nginx/sites-available/default
    ```
    Сотрите всё, что там есть, и вставьте это (замените `ВАШ_ДОМЕН.RU` на ваш реальный домен):

    ```nginx
    server {
        listen 80;
        server_name ВАШ_ДОМЕН.RU www.ВАШ_ДОМЕН.RU;

        location / {
            proxy_pass http://localhost:3000;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_cache_bypass $http_upgrade;
        }
    }
    ```
    Нажмите `Ctrl+O` (Enter) чтобы сохранить, и `Ctrl+X` чтобы выйти.

3.  **Перезапустите Nginx:**
    ```bash
    systemctl restart nginx
    ```

Теперь сайт должен открываться по http://ВАШ_ДОМЕН.RU.

## Шаг 7: Подключение HTTPS (Замочек)

Чтобы было безопасно (https):

1.  Установите Certbot:
    ```bash
    apt install -y certbot python3-certbot-nginx
    ```

2.  Получите сертификат:
    ```bash
    certbot --nginx -d ВАШ_ДОМЕН.RU -d www.ВАШ_ДОМЕН.RU
    ```
    Вас попросят ввести email и согласиться с правилами (введите `Y`).

**Готово! Ваш сайт работает.**

---

### Как обновлять сайт?

### Как обновлять сайт?

**Если используете Git:**
1.  На компьютере: `git push`
2.  На сервере:
    ```bash
    cd /root/app
    git pull
    npm install (если добавляли библиотеки)
    npm run build
    pm2 restart book-site
    ```

**Если через файлы:**
1.  Загрузите новые файлы (кроме `data`!) через Файловый менеджер с заменой.
2.  На сервере выполните те же команды (начиная с `npm install`).
